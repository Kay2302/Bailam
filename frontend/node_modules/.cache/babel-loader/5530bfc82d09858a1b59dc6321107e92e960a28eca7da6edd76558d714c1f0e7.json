{"ast":null,"code":"var _jsxFileName = \"D:\\\\UDW\\\\BaiLam\\\\frontend\\\\src\\\\contexts\\\\ProductContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// src/contexts/ProductContext.js\nimport React, { createContext, useState, useContext, useEffect } from 'react';\nimport { useAuth } from './AuthContext';\nimport { cartApi } from '../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ProductContext = /*#__PURE__*/createContext();\nexport const useProduct = () => {\n  _s();\n  return useContext(ProductContext);\n};\n_s(useProduct, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport const ProductProvider = ({\n  children\n}) => {\n  _s2();\n  const {\n    currentUser,\n    isAuthenticated\n  } = useAuth();\n  const [cart, setCart] = useState([]);\n  const [wishlist, setWishlist] = useState([]);\n  const [loading, setLoading] = useState(false);\n\n  // Lấy giỏ hàng từ API nếu đã đăng nhập, hoặc từ localStorage nếu chưa đăng nhập\n  useEffect(() => {\n    const loadCartAndWishlist = async () => {\n      try {\n        if (isAuthenticated && currentUser) {\n          setLoading(true);\n          // Lấy giỏ hàng từ API\n          const cartResponse = await cartApi.getCart(currentUser.id);\n          setCart(cartResponse.data);\n\n          // Lấy wishlist từ API\n          const wishlistResponse = await wishlistApi.getWishlist(currentUser.id);\n          setWishlist(wishlistResponse.data);\n        } else {\n          // Lấy từ localStorage nếu chưa đăng nhập\n          const storedCart = localStorage.getItem('cart');\n          const storedWishlist = localStorage.getItem('wishlist');\n          if (storedCart) {\n            setCart(JSON.parse(storedCart));\n          }\n          if (storedWishlist) {\n            setWishlist(JSON.parse(storedWishlist));\n          }\n        }\n      } catch (err) {\n        console.error('Error loading cart and wishlist:', err);\n      } finally {\n        setLoading(false);\n      }\n    };\n    loadCartAndWishlist();\n  }, [isAuthenticated, currentUser]);\n\n  // Cập nhật localStorage khi giỏ hàng thay đổi (chỉ khi chưa đăng nhập)\n  useEffect(() => {\n    if (!isAuthenticated) {\n      localStorage.setItem('cart', JSON.stringify(cart));\n    }\n  }, [cart, isAuthenticated]);\n\n  // Cập nhật localStorage khi wishlist thay đổi (chỉ khi chưa đăng nhập)\n  useEffect(() => {\n    if (!isAuthenticated) {\n      localStorage.setItem('wishlist', JSON.stringify(wishlist));\n    }\n  }, [wishlist, isAuthenticated]);\n\n  // Thêm vào giỏ hàng\n  const addToCart = async (product, quantity = 1) => {\n    try {\n      if (isAuthenticated && currentUser) {\n        // Lưu vào database thông qua API\n        const response = await cartApi.addToCart(currentUser.id, product.id, quantity);\n        setCart(response.data);\n      } else {\n        // Lưu vào localStorage\n        setCart(prevCart => {\n          const existingItemIndex = prevCart.findIndex(item => item.id === product.id);\n          if (existingItemIndex >= 0) {\n            // Item already exists, update quantity\n            const updatedCart = [...prevCart];\n            updatedCart[existingItemIndex] = {\n              ...updatedCart[existingItemIndex],\n              quantity: updatedCart[existingItemIndex].quantity + quantity\n            };\n            return updatedCart;\n          } else {\n            // Add new item\n            return [...prevCart, {\n              ...product,\n              quantity\n            }];\n          }\n        });\n      }\n    } catch (error) {\n      console.error('Error adding to cart:', error);\n    }\n  };\n\n  // Cập nhật số lượng sản phẩm\n  const updateCartItem = async (id, quantity) => {\n    try {\n      if (isAuthenticated && currentUser) {\n        // Cập nhật thông qua API\n        await cartApi.updateCartItem(currentUser.id, id, quantity);\n\n        // Cập nhật state\n        setCart(prevCart => prevCart.map(item => item.id === id ? {\n          ...item,\n          quantity\n        } : item));\n      } else {\n        // Cập nhật trong localStorage\n        setCart(prevCart => prevCart.map(item => item.id === id ? {\n          ...item,\n          quantity\n        } : item));\n      }\n    } catch (error) {\n      console.error('Error updating cart item:', error);\n    }\n  };\n\n  // Xóa khỏi giỏ hàng\n  const removeFromCart = async id => {\n    try {\n      if (isAuthenticated && currentUser) {\n        // Xóa thông qua API\n        await cartApi.removeFromCart(currentUser.id, id);\n      }\n\n      // Cập nhật state (cả đã đăng nhập và chưa đăng nhập)\n      setCart(prevCart => prevCart.filter(item => item.id !== id));\n    } catch (error) {\n      console.error('Error removing from cart:', error);\n    }\n  };\n\n  // Xóa giỏ hàng\n  const clearCart = async () => {\n    try {\n      if (isAuthenticated && currentUser) {\n        // Xóa thông qua API\n        await cartApi.clearCart(currentUser.id);\n      }\n\n      // Cập nhật state (cả đã đăng nhập và chưa đăng nhập)\n      setCart([]);\n    } catch (error) {\n      console.error('Error clearing cart:', error);\n    }\n  };\n\n  // Các hàm tương tự cho wishlist...\n\n  const value = {\n    cart,\n    wishlist,\n    loading,\n    addToCart,\n    updateCartItem,\n    removeFromCart,\n    clearCart,\n    getCartTotal: () => cart.reduce((total, item) => {\n      const price = item.discountPrice || item.price;\n      return total + price * item.quantity;\n    }, 0),\n    addToWishlist,\n    removeFromWishlist\n  };\n  return /*#__PURE__*/_jsxDEV(ProductContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 171,\n    columnNumber: 10\n  }, this);\n};\n_s2(ProductProvider, \"JU465xL3DIlWUYvjaf+2aMN0zMI=\", false, function () {\n  return [useAuth];\n});\n_c = ProductProvider;\nvar _c;\n$RefreshReg$(_c, \"ProductProvider\");","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","useAuth","cartApi","jsxDEV","_jsxDEV","ProductContext","useProduct","_s","ProductProvider","children","_s2","currentUser","isAuthenticated","cart","setCart","wishlist","setWishlist","loading","setLoading","loadCartAndWishlist","cartResponse","getCart","id","data","wishlistResponse","wishlistApi","getWishlist","storedCart","localStorage","getItem","storedWishlist","JSON","parse","err","console","error","setItem","stringify","addToCart","product","quantity","response","prevCart","existingItemIndex","findIndex","item","updatedCart","updateCartItem","map","removeFromCart","filter","clearCart","value","getCartTotal","reduce","total","price","discountPrice","addToWishlist","removeFromWishlist","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["D:/UDW/BaiLam/frontend/src/contexts/ProductContext.js"],"sourcesContent":["// src/contexts/ProductContext.js\r\nimport React, { createContext, useState, useContext, useEffect } from 'react';\r\nimport { useAuth } from './AuthContext';\r\nimport { cartApi } from '../services/api';\r\n\r\nconst ProductContext = createContext();\r\n\r\nexport const useProduct = () => useContext(ProductContext);\r\n\r\nexport const ProductProvider = ({ children }) => {\r\n  const { currentUser, isAuthenticated } = useAuth();\r\n  const [cart, setCart] = useState([]);\r\n  const [wishlist, setWishlist] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  // Lấy giỏ hàng từ API nếu đã đăng nhập, hoặc từ localStorage nếu chưa đăng nhập\r\n  useEffect(() => {\r\n    const loadCartAndWishlist = async () => {\r\n      try {\r\n        if (isAuthenticated && currentUser) {\r\n          setLoading(true);\r\n          // Lấy giỏ hàng từ API\r\n          const cartResponse = await cartApi.getCart(currentUser.id);\r\n          setCart(cartResponse.data);\r\n          \r\n          // Lấy wishlist từ API\r\n          const wishlistResponse = await wishlistApi.getWishlist(currentUser.id);\r\n          setWishlist(wishlistResponse.data);\r\n        } else {\r\n          // Lấy từ localStorage nếu chưa đăng nhập\r\n          const storedCart = localStorage.getItem('cart');\r\n          const storedWishlist = localStorage.getItem('wishlist');\r\n\r\n          if (storedCart) {\r\n            setCart(JSON.parse(storedCart));\r\n          }\r\n\r\n          if (storedWishlist) {\r\n            setWishlist(JSON.parse(storedWishlist));\r\n          }\r\n        }\r\n      } catch (err) {\r\n        console.error('Error loading cart and wishlist:', err);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadCartAndWishlist();\r\n  }, [isAuthenticated, currentUser]);\r\n\r\n  // Cập nhật localStorage khi giỏ hàng thay đổi (chỉ khi chưa đăng nhập)\r\n  useEffect(() => {\r\n    if (!isAuthenticated) {\r\n      localStorage.setItem('cart', JSON.stringify(cart));\r\n    }\r\n  }, [cart, isAuthenticated]);\r\n\r\n  // Cập nhật localStorage khi wishlist thay đổi (chỉ khi chưa đăng nhập)\r\n  useEffect(() => {\r\n    if (!isAuthenticated) {\r\n      localStorage.setItem('wishlist', JSON.stringify(wishlist));\r\n    }\r\n  }, [wishlist, isAuthenticated]);\r\n\r\n  // Thêm vào giỏ hàng\r\n  const addToCart = async (product, quantity = 1) => {\r\n    try {\r\n      if (isAuthenticated && currentUser) {\r\n        // Lưu vào database thông qua API\r\n        const response = await cartApi.addToCart(currentUser.id, product.id, quantity);\r\n        setCart(response.data);\r\n      } else {\r\n        // Lưu vào localStorage\r\n        setCart(prevCart => {\r\n          const existingItemIndex = prevCart.findIndex(item => item.id === product.id);\r\n          \r\n          if (existingItemIndex >= 0) {\r\n            // Item already exists, update quantity\r\n            const updatedCart = [...prevCart];\r\n            updatedCart[existingItemIndex] = {\r\n              ...updatedCart[existingItemIndex],\r\n              quantity: updatedCart[existingItemIndex].quantity + quantity\r\n            };\r\n            return updatedCart;\r\n          } else {\r\n            // Add new item\r\n            return [...prevCart, { ...product, quantity }];\r\n          }\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error adding to cart:', error);\r\n    }\r\n  };\r\n\r\n  // Cập nhật số lượng sản phẩm\r\n  const updateCartItem = async (id, quantity) => {\r\n    try {\r\n      if (isAuthenticated && currentUser) {\r\n        // Cập nhật thông qua API\r\n        await cartApi.updateCartItem(currentUser.id, id, quantity);\r\n        \r\n        // Cập nhật state\r\n        setCart(prevCart => \r\n          prevCart.map(item => \r\n            item.id === id ? { ...item, quantity } : item\r\n          )\r\n        );\r\n      } else {\r\n        // Cập nhật trong localStorage\r\n        setCart(prevCart => \r\n          prevCart.map(item => \r\n            item.id === id ? { ...item, quantity } : item\r\n          )\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating cart item:', error);\r\n    }\r\n  };\r\n\r\n  // Xóa khỏi giỏ hàng\r\n  const removeFromCart = async (id) => {\r\n    try {\r\n      if (isAuthenticated && currentUser) {\r\n        // Xóa thông qua API\r\n        await cartApi.removeFromCart(currentUser.id, id);\r\n      }\r\n      \r\n      // Cập nhật state (cả đã đăng nhập và chưa đăng nhập)\r\n      setCart(prevCart => prevCart.filter(item => item.id !== id));\r\n    } catch (error) {\r\n      console.error('Error removing from cart:', error);\r\n    }\r\n  };\r\n\r\n  // Xóa giỏ hàng\r\n  const clearCart = async () => {\r\n    try {\r\n      if (isAuthenticated && currentUser) {\r\n        // Xóa thông qua API\r\n        await cartApi.clearCart(currentUser.id);\r\n      }\r\n      \r\n      // Cập nhật state (cả đã đăng nhập và chưa đăng nhập)\r\n      setCart([]);\r\n    } catch (error) {\r\n      console.error('Error clearing cart:', error);\r\n    }\r\n  };\r\n\r\n  // Các hàm tương tự cho wishlist...\r\n\r\n  const value = {\r\n    cart,\r\n    wishlist,\r\n    loading,\r\n    addToCart,\r\n    updateCartItem,\r\n    removeFromCart,\r\n    clearCart,\r\n    getCartTotal: () => cart.reduce((total, item) => {\r\n      const price = item.discountPrice || item.price;\r\n      return total + (price * item.quantity);\r\n    }, 0),\r\n    addToWishlist,\r\n    removeFromWishlist\r\n  };\r\n\r\n  return <ProductContext.Provider value={value}>{children}</ProductContext.Provider>;\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}