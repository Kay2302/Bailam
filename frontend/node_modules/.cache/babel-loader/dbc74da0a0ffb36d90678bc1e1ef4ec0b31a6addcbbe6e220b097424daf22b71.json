{"ast":null,"code":"// src/services/api.js\nimport axios from 'axios';\n\n// Cập nhật URL API (điều chỉnh port nếu cần)\nconst API_URL = 'http://localhost:5000/api';\n\n// Tạo instance axios với cấu hình cơ bản\nconst apiClient = axios.create({\n  baseURL: API_URL,\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\n\n// Thêm interceptor để đính kèm token xác thực khi có sẵn\napiClient.interceptors.request.use(config => {\n  const token = localStorage.getItem('token');\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n});\n\n// Thêm interceptor để xử lý lỗi 401 (Unauthorized)\napiClient.interceptors.response.use(response => response, error => {\n  console.error('API Error:', error);\n  if (error.response) {\n    console.error('Response data:', error.response.data);\n    console.error('Response status:', error.response.status);\n  }\n  if (error.response && error.response.status === 401) {\n    // Xóa thông tin xác thực\n    localStorage.removeItem('token');\n    localStorage.removeItem('userId');\n    localStorage.removeItem('userRole');\n\n    // Không tự động chuyển hướng để tránh vòng lặp vô hạn\n    // Thay vào đó, set một flag để component xử lý\n    localStorage.setItem('authError', 'true');\n  }\n  return Promise.reject(error);\n});\n\n// API Người dùng (cập nhật)\nexport const userApi = {\n  register: async userData => {\n    console.log('Register data:', userData);\n    try {\n      return await apiClient.post('/users/register', userData);\n    } catch (error) {\n      console.error('Register error:', error);\n      throw error;\n    }\n  },\n  login: async credentials => {\n    console.log('Login credentials:', {\n      email: credentials.email\n    });\n    try {\n      return await apiClient.post('/users/login', credentials);\n    } catch (error) {\n      console.error('Login error:', error);\n      throw error;\n    }\n  },\n  getProfile: async id => {\n    try {\n      return await apiClient.get(`/users/${id}`);\n    } catch (error) {\n      console.error(`Error fetching user profile:`, error);\n      throw error;\n    }\n  },\n  updateProfile: async (id, data) => {\n    try {\n      return await apiClient.put(`/users/${id}`, data);\n    } catch (error) {\n      console.error(`Error updating user profile:`, error);\n      throw error;\n    }\n  },\n  changePassword: async (id, data) => {\n    try {\n      return await apiClient.put(`/users/${id}/password`, data);\n    } catch (error) {\n      console.error(`Error changing password:`, error);\n      throw error;\n    }\n  },\n  getAllUsers: async () => {\n    try {\n      return await apiClient.get('/users');\n    } catch (error) {\n      console.error('Error fetching all users:', error);\n      return {\n        data: []\n      };\n    }\n  }\n};\n\n// Giữ nguyên các API khác...\n\nexport default {\n  product: productApi,\n  review: reviewApi,\n  category: categoryApi,\n  order: orderApi,\n  user: userApi,\n  cart: cartApi\n};","map":{"version":3,"names":["axios","API_URL","apiClient","create","baseURL","headers","interceptors","request","use","config","token","localStorage","getItem","Authorization","response","error","console","data","status","removeItem","setItem","Promise","reject","userApi","register","userData","log","post","login","credentials","email","getProfile","id","get","updateProfile","put","changePassword","getAllUsers","product","productApi","review","reviewApi","category","categoryApi","order","orderApi","user","cart","cartApi"],"sources":["D:/UDW/BaiLam/frontend/src/services/api.js"],"sourcesContent":["// src/services/api.js\r\nimport axios from 'axios';\r\n\r\n// Cập nhật URL API (điều chỉnh port nếu cần)\r\nconst API_URL = 'http://localhost:5000/api';\r\n\r\n// Tạo instance axios với cấu hình cơ bản\r\nconst apiClient = axios.create({\r\n  baseURL: API_URL,\r\n  headers: {\r\n    'Content-Type': 'application/json'\r\n  }\r\n});\r\n\r\n// Thêm interceptor để đính kèm token xác thực khi có sẵn\r\napiClient.interceptors.request.use(config => {\r\n  const token = localStorage.getItem('token');\r\n  if (token) {\r\n    config.headers.Authorization = `Bearer ${token}`;\r\n  }\r\n  return config;\r\n});\r\n\r\n// Thêm interceptor để xử lý lỗi 401 (Unauthorized)\r\napiClient.interceptors.response.use(\r\n  response => response,\r\n  error => {\r\n    console.error('API Error:', error);\r\n    if (error.response) {\r\n      console.error('Response data:', error.response.data);\r\n      console.error('Response status:', error.response.status);\r\n    }\r\n    \r\n    if (error.response && error.response.status === 401) {\r\n      // Xóa thông tin xác thực\r\n      localStorage.removeItem('token');\r\n      localStorage.removeItem('userId');\r\n      localStorage.removeItem('userRole');\r\n      \r\n      // Không tự động chuyển hướng để tránh vòng lặp vô hạn\r\n      // Thay vào đó, set một flag để component xử lý\r\n      localStorage.setItem('authError', 'true');\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\n// API Người dùng (cập nhật)\r\nexport const userApi = {\r\n  register: async (userData) => {\r\n    console.log('Register data:', userData);\r\n    try {\r\n      return await apiClient.post('/users/register', userData);\r\n    } catch (error) {\r\n      console.error('Register error:', error);\r\n      throw error;\r\n    }\r\n  },\r\n  \r\n  login: async (credentials) => {\r\n    console.log('Login credentials:', { email: credentials.email });\r\n    try {\r\n      return await apiClient.post('/users/login', credentials);\r\n    } catch (error) {\r\n      console.error('Login error:', error);\r\n      throw error;\r\n    }\r\n  },\r\n  \r\n  getProfile: async (id) => {\r\n    try {\r\n      return await apiClient.get(`/users/${id}`);\r\n    } catch (error) {\r\n      console.error(`Error fetching user profile:`, error);\r\n      throw error;\r\n    }\r\n  },\r\n  \r\n  updateProfile: async (id, data) => {\r\n    try {\r\n      return await apiClient.put(`/users/${id}`, data);\r\n    } catch (error) {\r\n      console.error(`Error updating user profile:`, error);\r\n      throw error;\r\n    }\r\n  },\r\n  \r\n  changePassword: async (id, data) => {\r\n    try {\r\n      return await apiClient.put(`/users/${id}/password`, data);\r\n    } catch (error) {\r\n      console.error(`Error changing password:`, error);\r\n      throw error;\r\n    }\r\n  },\r\n  \r\n  getAllUsers: async () => {\r\n    try {\r\n      return await apiClient.get('/users');\r\n    } catch (error) {\r\n      console.error('Error fetching all users:', error);\r\n      return { data: [] };\r\n    }\r\n  }\r\n};\r\n\r\n// Giữ nguyên các API khác...\r\n\r\nexport default {\r\n  product: productApi,\r\n  review: reviewApi,\r\n  category: categoryApi,\r\n  order: orderApi,\r\n  user: userApi,\r\n  cart: cartApi\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}